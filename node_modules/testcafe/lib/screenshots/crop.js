'use strict';

exports.__esModule = true;
exports.cropScreenshot = undefined;

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

let cropScreenshot = exports.cropScreenshot = (() => {
    var _ref = (0, _asyncToGenerator3.default)(function* (image, { path, markSeed, clientAreaDimensions, cropDimensions }) {
        if (!markSeed && !cropDimensions) return null;

        const clip = calculateClipInfo(image, path, markSeed, clientAreaDimensions, cropDimensions);

        return (0, _utils.copyImagePart)(image, clip);
    });

    return function cropScreenshot(_x, _x2) {
        return _ref.apply(this, arguments);
    };
})();

exports.calculateMarkPosition = calculateMarkPosition;
exports.getClipInfoByMarkPosition = getClipInfoByMarkPosition;
exports.getClipInfoByCropDimensions = getClipInfoByCropDimensions;
exports.calculateClipInfo = calculateClipInfo;

var _utils = require('./utils');

var _limitNumber = require('../utils/limit-number');

var _limitNumber2 = _interopRequireDefault(_limitNumber);

var _renderTemplate = require('../utils/render-template');

var _renderTemplate2 = _interopRequireDefault(_renderTemplate);

var _testRun = require('../errors/test-run/');

var _constants = require('./constants');

var _warningMessage = require('../notifications/warning-message');

var _warningMessage2 = _interopRequireDefault(_warningMessage);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function markSeedToId(markSeed) {
    let id = 0;

    for (let i = 0; i < _constants.MARK_LENGTH; i++) id = id * 2 + (markSeed[i * _constants.MARK_BYTES_PER_PIXEL] ? 1 : 0);

    return id;
}

function calculateMarkPosition(pngImage, markSeed) {
    const mark = Buffer.from(markSeed);
    const markIndex = pngImage.data.indexOf(mark);

    if (markIndex < 0) return null;

    const endPosition = markIndex / _constants.MARK_BYTES_PER_PIXEL + _constants.MARK_LENGTH + _constants.MARK_RIGHT_MARGIN;

    const x = endPosition % pngImage.width || pngImage.width;
    const y = (endPosition - x) / pngImage.width + 1;

    return { x, y };
}

function getClipInfoByMarkPosition(markPosition, { width, height }) {
    const x = markPosition.x,
          y = markPosition.y;


    const clipRight = x;
    const clipBottom = y;
    const clipLeft = clipRight - width;
    const clipTop = clipBottom - height;

    return {
        clipLeft,
        clipTop,
        clipRight,
        clipBottom
    };
}

function getClipInfoByCropDimensions({ clipRight, clipLeft, clipBottom, clipTop }, cropDimensions) {
    if (cropDimensions) {
        const right = cropDimensions.right,
              top = cropDimensions.top,
              bottom = cropDimensions.bottom,
              left = cropDimensions.left;


        clipRight = (0, _limitNumber2.default)(clipLeft + right, clipLeft, clipRight);
        clipBottom = (0, _limitNumber2.default)(clipTop + bottom, clipTop, clipBottom);
        clipLeft = (0, _limitNumber2.default)(clipLeft + left, clipLeft, clipRight);
        clipTop = (0, _limitNumber2.default)(clipTop + top, clipTop, clipBottom);
    }

    return {
        clipLeft,
        clipTop,
        clipRight,
        clipBottom
    };
}

function calculateClipInfo(pngImage, path, markSeed, clientAreaDimensions, cropDimensions) {
    let clipInfo = {
        clipRight: pngImage.width,
        clipBottom: pngImage.height,
        clipLeft: 0,
        clipTop: 0
    };

    let markPosition = null;

    if (markSeed && clientAreaDimensions) {
        markPosition = calculateMarkPosition(pngImage, markSeed);

        if (!markPosition) throw new Error((0, _renderTemplate2.default)(_warningMessage2.default.screenshotMarkNotFound, path, markSeedToId(markSeed)));

        clipInfo = getClipInfoByMarkPosition(markPosition, clientAreaDimensions);
    }

    clipInfo = getClipInfoByCropDimensions(clipInfo, cropDimensions);

    if (markPosition && markPosition.y === clipInfo.clipBottom) clipInfo.clipBottom--;

    const clipWidth = clipInfo.clipRight - clipInfo.clipLeft;
    const clipHeight = clipInfo.clipBottom - clipInfo.clipTop;

    if (clipWidth <= 0 || clipHeight <= 0) throw new _testRun.InvalidElementScreenshotDimensionsError(clipWidth, clipHeight);

    return clipInfo;
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zY3JlZW5zaG90cy9jcm9wLmpzIl0sIm5hbWVzIjpbImltYWdlIiwicGF0aCIsIm1hcmtTZWVkIiwiY2xpZW50QXJlYURpbWVuc2lvbnMiLCJjcm9wRGltZW5zaW9ucyIsImNsaXAiLCJjYWxjdWxhdGVDbGlwSW5mbyIsImNyb3BTY3JlZW5zaG90IiwiY2FsY3VsYXRlTWFya1Bvc2l0aW9uIiwiZ2V0Q2xpcEluZm9CeU1hcmtQb3NpdGlvbiIsImdldENsaXBJbmZvQnlDcm9wRGltZW5zaW9ucyIsIm1hcmtTZWVkVG9JZCIsImlkIiwiaSIsIk1BUktfTEVOR1RIIiwiTUFSS19CWVRFU19QRVJfUElYRUwiLCJwbmdJbWFnZSIsIm1hcmsiLCJCdWZmZXIiLCJmcm9tIiwibWFya0luZGV4IiwiZGF0YSIsImluZGV4T2YiLCJlbmRQb3NpdGlvbiIsIk1BUktfUklHSFRfTUFSR0lOIiwieCIsIndpZHRoIiwieSIsIm1hcmtQb3NpdGlvbiIsImhlaWdodCIsImNsaXBSaWdodCIsImNsaXBCb3R0b20iLCJjbGlwTGVmdCIsImNsaXBUb3AiLCJyaWdodCIsInRvcCIsImJvdHRvbSIsImxlZnQiLCJjbGlwSW5mbyIsIkVycm9yIiwiV0FSTklOR19NRVNTQUdFUyIsInNjcmVlbnNob3RNYXJrTm90Rm91bmQiLCJjbGlwV2lkdGgiLCJjbGlwSGVpZ2h0IiwiSW52YWxpZEVsZW1lbnRTY3JlZW5zaG90RGltZW5zaW9uc0Vycm9yIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OytDQW1HTyxXQUErQkEsS0FBL0IsRUFBc0MsRUFBRUMsSUFBRixFQUFRQyxRQUFSLEVBQWtCQyxvQkFBbEIsRUFBd0NDLGNBQXhDLEVBQXRDLEVBQWdHO0FBQ25HLFlBQUksQ0FBQ0YsUUFBRCxJQUFhLENBQUNFLGNBQWxCLEVBQ0ksT0FBTyxJQUFQOztBQUVKLGNBQU1DLE9BQU9DLGtCQUFrQk4sS0FBbEIsRUFBeUJDLElBQXpCLEVBQStCQyxRQUEvQixFQUF5Q0Msb0JBQXpDLEVB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QTRCVSxRQUE1QixFQUFzQ2YsSUFBdEMsRUFBNENDLFFBQTVDLEVBQXNEQyxvQkFBdEQsRUFBNEVDLGNBQTVFLEVBQTRGO0FBQy9GLFFBQUlrQyxXQUFXO0FBQ1hSLG1CQUFZZCxTQUFTVSxLQURWO0FBRVhLLG9CQUFZZixTQUFTYSxNQUZWO0FBR1hHLGtCQUFZLENBSEQ7QUFJWEMsaUJBQVk7QUFKRCxLQUFmOztBQU9BLFFBQUlMLGVBQWUsSUFBbkI7O0FBRUEsUUFBSTFCLFlBQVlDLG9CQUFoQixFQUFzQztBQUNsQ3lCLHVCQUFlcEIsc0JBQXNCUSxRQUF0QixFQUFnQ2QsUUFBaEMsQ0FBZjs7QUFFQSxZQUFJLENBQUMwQixZQUFMLEVBQ0ksTUFBTSxJQUFJVyxLQUFKLENBQVUsOEJBQWVDLHlCQUFpQkMsc0JBQWhDLEVBQXdEeEMsSUFBeEQsRUFBOERVLGFBQWFULFFBQWIsQ0FBOUQsQ0FBVixDQUFOOztBQUVKb0MsbUJBQVc3QiwwQkFBMEJtQixZQUExQixFQUF3Q3pCLG9CQUF4QyxDQUFYO0FBQ0g7O0FBRURtQyxlQUFXNUIsNEJBQTRCNEIsUUFBNUIsRUFBc0NsQyxjQUF0QyxDQUFYOztBQUVBLFFBQUl3QixnQkFBZ0JBLGFBQWFELENBQWIsS0FBbUJXLFNBQVNQLFVBQWhELEVBQ0lPLFNBQVNQLFVBQVQ7O0FBRUosVUFBTVcsWUFBYUosU0FBU1IsU0FBVCxHQUFxQlEsU0FBU04sUUFBakQ7QUFDQSxVQUFNVyxhQUFhTCxTQUFTUCxVQUFULEdBQXNCTyxTQUFTTCxPQUFsRDs7QUFFQSxRQUFJUyxhQUFhLENBQWIsSUFBa0JDLGNBQWMsQ0FBcEMsRUFDSSxNQUFNLElBQUlDLGdEQUFKLENBQTRDRixTQUE1QyxFQUF1REMsVUFBdkQsQ0FBTjs7QUFFSixXQUFPTCxRQUFQO0FBQ0giLCJmaWxlIjoic2NyZWVuc2hvdHMvY3JvcC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNvcHlJbWFnZVBhcnQgfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCBsaW1pdE51bWJlciBmcm9tICcuLi91dGlscy9saW1pdC1udW1iZXInO1xuaW1wb3J0IHJlbmRlclRlbXBsYXRlIGZyb20gJy4uL3V0aWxzL3JlbmRlci10ZW1wbGF0ZSc7XG5pbXBvcnQgeyBJbnZhbGlkRWxlbWVudFNjcmVlbnNob3REaW1lbnNpb25zRXJyb3IgfSBmcm9tICcuLi9lcnJvcnMvdGVzdC1ydW4vJztcbmltcG9ydCB7IE1BUktfTEVOR1RILCBNQVJLX1JJR0hUX01BUkdJTiwgTUFSS19CWVRFU19QRVJfUElYRUwgfSBmcm9tICcuL2NvbnN0YW50cyc7XG5pbXBvcnQgV0FSTklOR19NRVNTQUdFUyBmcm9tICcuLi9ub3RpZmljYXRpb25zL3dhcm5pbmctbWVzc2FnZSc7XG5cblxuZnVuY3Rpb24gbWFya1NlZWRUb0lkIChtYXJrU2VlZCkge1xuICAgIGxldCBpZCA9IDA7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IE1BUktfTEVOR1RIOyBpKyspXG4gICAgICAgIGlkID0gaWQgKiAyICsgKG1hcmtTZWVkW2kgKiBNQVJLX0JZVEVTX1BFUl9QSVhFTF0gPyAxIDogMCk7XG5cbiAgICByZXR1cm4gaWQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVNYXJrUG9zaXRpb24gKHBuZ0ltYWdlLCBtYXJrU2VlZCkge1xuICAgIGNvbnN0IG1hcmsgICAgICA9IEJ1ZmZlci5mcm9tKG1hcmtTZWVkKTtcbiAgICBjb25zdCBtYXJrSW5kZXggPSBwbmdJbWFnZS5kYXRhLmluZGV4T2YobWFyayk7XG5cbiAgICBpZiAobWFya0luZGV4IDwgMClcbiAgICAgICAgcmV0dXJuIG51bGw7XG5cbiAgICBjb25zdCBlbmRQb3NpdGlvbiA9IG1hcmtJbmRleCAvIE1BUktfQllURVNfUEVSX1BJWEVMICsgTUFSS19MRU5HVEggKyBNQVJLX1JJR0hUX01BUkdJTjtcblxuICAgIGNvbnN0IHggPSBlbmRQb3NpdGlvbiAlIHBuZ0ltYWdlLndpZHRoIHx8IHBuZ0ltYWdlLndpZHRoO1xuICAgIGNvbnN0IHkgPSAoZW5kUG9zaXRpb24gLSB4KSAvIHBuZ0ltYWdlLndpZHRoICsgMTtcblxuICAgIHJldHVybiB7IHgsIHkgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldENsaXBJbmZvQnlNYXJrUG9zaXRpb24gKG1hcmtQb3NpdGlvbiwgeyB3aWR0aCwgaGVpZ2h0IH0pIHtcbiAgICBjb25zdCB7IHgsIHkgfSA9IG1hcmtQb3NpdGlvbjtcblxuICAgIGNvbnN0IGNsaXBSaWdodCAgPSB4O1xuICAgIGNvbnN0IGNsaXBCb3R0b20gPSB5O1xuICAgIGNvbnN0IGNsaXBMZWZ0ICAgPSBjbGlwUmlnaHQgLSB3aWR0aDtcbiAgICBjb25zdCBjbGlwVG9wICAgID0gY2xpcEJvdHRvbSAtIGhlaWdodDtcblxuICAgIHJldHVybiB7XG4gICAgICAgIGNsaXBMZWZ0LFxuICAgICAgICBjbGlwVG9wLFxuICAgICAgICBjbGlwUmlnaHQsXG4gICAgICAgIGNsaXBCb3R0b21cbiAgICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2xpcEluZm9CeUNyb3BEaW1lbnNpb25zICh7IGNsaXBSaWdodCwgY2xpcExlZnQsIGNsaXBCb3R0b20sIGNsaXBUb3AgfSwgY3JvcERpbWVuc2lvbnMpIHtcbiAgICBpZiAoY3JvcERpbWVuc2lvbnMpIHtcbiAgICAgICAgY29uc3QgeyByaWdodCwgdG9wLCBib3R0b20sIGxlZnQgfSA9IGNyb3BEaW1lbnNpb25zO1xuXG4gICAgICAgIGNsaXBSaWdodCAgPSBsaW1pdE51bWJlcihjbGlwTGVmdCArIHJpZ2h0LCBjbGlwTGVmdCwgY2xpcFJpZ2h0KTtcbiAgICAgICAgY2xpcEJvdHRvbSA9IGxpbWl0TnVtYmVyKGNsaXBUb3AgKyBib3R0b20sIGNsaXBUb3AsIGNsaXBCb3R0b20pO1xuICAgICAgICBjbGlwTGVmdCAgID0gbGltaXROdW1iZXIoY2xpcExlZnQgKyBsZWZ0LCBjbGlwTGVmdCwgY2xpcFJpZ2h0KTtcbiAgICAgICAgY2xpcFRvcCAgICA9IGxpbWl0TnVtYmVyKGNsaXBUb3AgKyB0b3AsIGNsaXBUb3AsIGNsaXBCb3R0b20pO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIGNsaXBMZWZ0LFxuICAgICAgICBjbGlwVG9wLFxuICAgICAgICBjbGlwUmlnaHQsXG4gICAgICAgIGNsaXBCb3R0b21cbiAgICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlQ2xpcEluZm8gKHBuZ0ltYWdlLCBwYXRoLCBtYXJrU2VlZCwgY2xpZW50QXJlYURpbWVuc2lvbnMsIGNyb3BEaW1lbnNpb25zKSB7XG4gICAgbGV0IGNsaXBJbmZvID0ge1xuICAgICAgICBjbGlwUmlnaHQ6ICBwbmdJbWFnZS53aWR0aCxcbiAgICAgICAgY2xpcEJvdHRvbTogcG5nSW1hZ2UuaGVpZ2h0LFxuICAgICAgICBjbGlwTGVmdDogICAwLFxuICAgICAgICBjbGlwVG9wOiAgICAwXG4gICAgfTtcblxuICAgIGxldCBtYXJrUG9zaXRpb24gPSBudWxsO1xuXG4gICAgaWYgKG1hcmtTZWVkICYmIGNsaWVudEFyZWFEaW1lbnNpb25zKSB7XG4gICAgICAgIG1hcmtQb3NpdGlvbiA9IGNhbGN1bGF0ZU1hcmtQb3NpdGlvbihwbmdJbWFnZSwgbWFya1NlZWQpO1xuXG4gICAgICAgIGlmICghbWFya1Bvc2l0aW9uKVxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHJlbmRlclRlbXBsYXRlKFdBUk5JTkdfTUVTU0FHRVMuc2NyZWVuc2hvdE1hcmtOb3RGb3VuZCwgcGF0aCwgbWFya1NlZWRUb0lkKG1hcmtTZWVkKSkpO1xuXG4gICAgICAgIGNsaXBJbmZvID0gZ2V0Q2xpcEluZm9CeU1hcmtQb3NpdGlvbihtYXJrUG9zaXRpb24sIGNsaWVudEFyZWFEaW1lbnNpb25zKTtcbiAgICB9XG5cbiAgICBjbGlwSW5mbyA9IGdldENsaXBJbmZvQnlDcm9wRGltZW5zaW9ucyhjbGlwSW5mbywgY3JvcERpbWVuc2lvbnMpO1xuXG4gICAgaWYgKG1hcmtQb3NpdGlvbiAmJiBtYXJrUG9zaXRpb24ueSA9PT0gY2xpcEluZm8uY2xpcEJvdHRvbSlcbiAgICAgICAgY2xpcEluZm8uY2xpcEJvdHRvbS0tO1xuXG4gICAgY29uc3QgY2xpcFdpZHRoICA9IGNsaXBJbmZvLmNsaXBSaWdodCAtIGNsaXBJbmZvLmNsaXBMZWZ0O1xuICAgIGNvbnN0IGNsaXBIZWlnaHQgPSBjbGlwSW5mby5jbGlwQm90dG9tIC0gY2xpcEluZm8uY2xpcFRvcDtcblxuICAgIGlmIChjbGlwV2lkdGggPD0gMCB8fCBjbGlwSGVpZ2h0IDw9IDApXG4gICAgICAgIHRocm93IG5ldyBJbnZhbGlkRWxlbWVudFNjcmVlbnNob3REaW1lbnNpb25zRXJyb3IoY2xpcFdpZHRoLCBjbGlwSGVpZ2h0KTtcblxuICAgIHJldHVybiBjbGlwSW5mbztcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyb3BTY3JlZW5zaG90IChpbWFnZSwgeyBwYXRoLCBtYXJrU2VlZCwgY2xpZW50QXJlYURpbWVuc2lvbnMsIGNyb3BEaW1lbnNpb25zIH0pIHtcbiAgICBpZiAoIW1hcmtTZWVkICYmICFjcm9wRGltZW5zaW9ucylcbiAgICAgICAgcmV0dXJuIG51bGw7XG5cbiAgICBjb25zdCBjbGlwID0gY2FsY3VsYXRlQ2xpcEluZm8oaW1hZ2UsIHBhdGgsIG1hcmtTZWVkLCBjbGllbnRBcmVhRGltZW5zaW9ucywgY3JvcERpbWVuc2lvbnMpO1xuXG4gICAgcmV0dXJuIGNvcHlJbWFnZVBhcnQoaW1hZ2UsIGNsaXApO1xufVxuIl19
